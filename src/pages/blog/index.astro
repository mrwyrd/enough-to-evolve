---
import BaseLayout from '../../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

const PAGE_SIZE = 10;

const posts = (await getCollection('blog', ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

const totalPages = Math.max(1, Math.ceil(posts.length / PAGE_SIZE));
const slice = posts.slice(0, PAGE_SIZE);
---

<BaseLayout title="Blog">
  <h1 class="h1">Blog</h1>
  <p class="muted">Practical posts, templates, scripts, and experiments. No motivational foam.</p>

  <ul class="post-list">
    {slice.map((p) => (
      <li class="card" style="padding:14px">
        <a href={`/blog/${p.slug}`}> <b>{p.data.title}</b> </a>
        <div class="post-meta">
          {p.data.pubDate.toLocaleDateString()}
          {p.data.tags?.length ? (
            <span>
              {' '}•{' '}
              {p.data.tags.slice(0, 4).map((t, i) => (
                <span>
                  <a href={`/tags/${t}/`}>{t}</a>
                  {i < Math.min(4, p.data.tags.length) - 1 ? ', ' : ''}
                </span>
              ))}
            </span>
          ) : null}
        </div>
        {p.data.description && <div class="muted">{p.data.description}</div>}
      </li>
    ))}
  </ul>

  {totalPages > 1 && (
    <div style="margin-top: 14px">
      <a class="focusable" href="/blog/page/2/"><b>Older posts →</b></a>
    </div>
  )}
</BaseLayout>
